import React, { useContext, useEffect, useState } from 'react'
import { AxiosPost, UserContext } from '../../../context/UserContext'
import JobsTable from './components/JobsTable'
import { pushNotify } from '../../../services/NotifyService'

function Jobs() {
  const { logout, setPath } = useContext(UserContext)
  const [isLoading, setIsLoading] = useState(false)
  const [jobs, setJobs] = useState([])

  const fetchJobs = async () => {
    try {
      setIsLoading(true)
      const data = await AxiosPost("fetch_jobs.php")
      console.log(data)
      if (data.success) {
        setJobs(data.jobs)
      } else {
        pushNotify("error", "Error", data.error)
      }
    } catch {
      pushNotify("error", "Error", "Server Error!")
    } finally {
      setIsLoading(false)
    }
  }

  useEffect(() => {
    setPath(window.location.pathname)
  },[])

  return (
    <>
      <JobsTable isLoading={isLoading} jobs={jobs} fetchJobs={fetchJobs}></JobsTable>
    </>
  )
}

export default Jobs